"use strict";!function e(t,n,i){function r(a,l){if(!n[a]){if(!t[a]){var c="function"==typeof require&&require;if(!l&&c)return c(a,!0);if(o)return o(a,!0);throw new Error("Cannot find module '"+a+"'")}var s=n[a]={exports:{}};t[a][0].call(s.exports,function(e){var n=t[a][1][e];return r(n?n:e)},s,s.exports,e,t,n,i)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)r(i[a]);return r}({1:[function(e,t,n){!function(){function t(){var e=new XMLHttpRequest,t=void 0;e.onreadystatechange=function(){if(4==e.readyState&&200==e.status){try{t=JSON.parse(e.response)}catch(e){alert("Invalid Server response. Sorry!")}l=new a(t)}},e.open("GET","data/image_posts.json"),e.send()}function n(e,t){var n=1e3*parseFloat(window.getComputedStyle(t).transitionDuration);"in"==e?(t.style.display="block",t.style.opacity=0,setTimeout(function(){t.style.opacity=1},4)):(t.style.opacity=0,setTimeout(function(){t.style.display="none"},n))}function i(e,t){var n=e.className.split(" ");return n.indexOf(t)>-1}function r(e,t){var n=e.className.split(" "),i=n.indexOf(t);i>-1&&n.splice(i,1),e.className=n.join(" ")}function o(e,t){i(e,t)||(e.className+=" "+t)}var a=(e("./modules/scrollbar.es6.js"),e("./modules/image-collection.es6.js")),l={};t(),document.addEventListener("DOMContentLoaded",function(){function e(e){var t=a.nicknameNode,n=a.commentNode,i=e.target,r=a.button;i.value&&(i.style.borderColor=""),i.value||(r.style.cursor=""),t.value&&n.value&&(r.style.cursor="pointer")}var t=function(){var e=document.querySelector(".popup.orientation-chose");return function(t){var i=t.target.files[0],r=/^image\//,o=void 0;if(i){if(!r.test(i.type))return void alert("You must upload an image!");o=new FileReader,o.onload=function(t){var i=e.querySelectorAll("img");[].forEach.call(i,function(e){e.src=t.target.result}),n("in",e)},o.readAsDataURL(i)}}}();document.querySelector('input[type="file"]').addEventListener("change",t);var a=document.querySelector(".popup-comments");a.nicknameNode=document.getElementById("nickname"),a.commentNode=document.getElementById("comment"),a.nicknameLabel=document.querySelector('[for="nickname"]'),a.commentLabel=document.querySelector('[for="comment"]'),a.placeholders={nickname:a.nicknameLabel.getAttribute("data-placeholder"),comment:a.commentLabel.getAttribute("data-placeholder")},a.button=document.querySelector(".send-button");var c=function(){var e=a.placeholders;return function(t){var n=t.target;if("INPUT"===n.tagName){var i=n.nextElementSibling;n.value?(n.style.borderColor="",i.setAttribute("data-placeholder","")):(n.style.borderColor="red",i.style.color="red",i.setAttribute("data-placeholder",e[n.id]))}}}();a.addEventListener("blur",c,!0),a.addEventListener("input",e);var s=function(){function e(e){var t=+e.getAttribute("data-id"),i=l.getImagePost(t);m.style.backgroundImage="url("+i.imgBig+")",p.setAttribute("data-count",i.likes),f.setAttribute("data-count",i.dislikes),g.textContent=i.comments.length,i.showComments(u.querySelector(".comments")),n("in",u),u.currentId=t}function t(e,t){l.addImagePost({imgBig:e,orientation:t}),n("out",v)}function c(e){if("I"===e.tagName&&(e=e.parentNode),!i(e,"clicked")){var t=u.querySelector(".image-button.clicked"),n=i(e,"like");t&&(r(t,"clicked"),l.evaluate(u.currentId,!n,!1,t)),o(e,"clicked"),l.evaluate(u.currentId,n,!0,e)}}function s(){!a.nicknameNode.value||!a.commentNode.value}function d(){var e=u.querySelector(".clicked");e&&r(e,"clicked");var t=a.nicknameNode,n=a.commentNode,i=a.placeholders.nickname,o=a.placeholders.comment,l=a.nicknameLabel,c=a.commentLabel;t.value=n.value="",t.style.borderColor=n.style.borderColor="",l.style.color=c.style.color="",a.button.style.cursor="",l.setAttribute("data-placeholder",i),c.setAttribute("data-placeholder",o)}var u=document.querySelector(".popup.big-img"),m=u.querySelector(".image-big"),p=u.querySelector(".sprite-like"),f=u.querySelector(".sprite-dislike"),g=u.querySelector("h2 span"),v=document.querySelector(".popup.orientation-chose"),h=void 0;return function(r){var o=r.target;"IMG"===o.tagName?e(o):(h=o.getAttribute("data-orientation"))?t(o.firstElementChild.src,h):i(o,"image-button")||i(o.parentNode,"image-button")?c(o):i(o,"sprite-close")?(d(),n("out",u)):(i(o,"send-button")||i(o.parentNode,"send-button"))&&(s(),r.preventDefault())}}();document.body.addEventListener("click",s)})}()},{"./modules/image-collection.es6.js":2,"./modules/scrollbar.es6.js":3}],2:[function(e,t,n){!function(){function n(e){function t(e){for(var t=0,n=0,i=e.length;n<i;n++)t=e[n].id>t?e[n].id:t;return t}for(var n=[],r=t(e),o=0,a=e.length;o<a;o++)n.push(new i(e[o]));this.getImagePost=function(e){for(var t=0,i=n.length;t<i;t++)if(n[t].id===e)return n[t];console.log("No image post with id:",e)},this.addImagePost=function(e){e.id||(e.id=++r);var t=new i(e);n.push(t)}}function i(e){var t=this;this.id=e.id||null,this.imgSmall=e.imgSmall||e.imgBig,this.imgBig=e.imgBig,this.orientation=e.orientation||"normal",this.likes=e.likes||0,this.dislikes=e.dislikes||0,this.comments=[],e.comments&&e.comments.forEach(function(e){t.comments.push(new o(e.text,e.nickname,e.date))}),this.node=r(this)}function r(e){function t(e,t){var n=document.createElement("I");return n.className="sprite "+e,n.setAttribute("data-count",t),n}var n=void 0,i=void 0,r=void 0;switch(n=document.createElement("DIV"),e.orientation){case"landscape":n.className="grid-item grid-item--width";break;case"portrait":n.className="grid-item grid-item--height";break;default:n.className="grid-item"}return i=document.createElement("IMG"),i.src=e.imgSmall,i.alt="Image "+e.id,i.setAttribute("data-id",e.id),n.appendChild(i),r=document.createElement("DIV"),r.className="hover-box",r.appendChild(t("sprite-comment",e.comments.length)),r.appendChild(t("sprite-like",e.likes)),r.appendChild(t("sprite-dislike",e.dislikes)),n.appendChild(r),l.insertBefore(n,l.lastElementChild),c.reloadItems(),c.layout(),s.adjustSize(),n}function o(e,t,n){this.text=e,this.nickname=t,this.date=new Date(n)}var a=e("./scrollbar.es6.js"),l=document.querySelector(".grid"),c=new Packery(l,{itemSelector:".grid-item",gutter:10,horizontal:!0}),s=new a(document.querySelector(".scroll-bar"),"h");s.adjustSize(),n.prototype.evaluate=function(e,t,n,i){var r=this.getImagePost(e),o=document.querySelector('[data-id="'+e+'"]'),a=t?"like":"dislike",l=o.nextElementSibling.querySelector(".sprite-"+a),c=void 0;c=n?++r[a+"s"]:--r[a+"s"],l.setAttribute("data-count",c),i.firstElementChild.setAttribute("data-count",c)},i.prototype.showComments=function(e){e.innerHTML="",this.comments.forEach(function(t){t.putOnPage(e)})},o.prototype.putOnPage=function(e){function t(e,t){var n=document.createElement("SPAN");return n.className=e,n.textContent=t,n}var n=document.createElement("DIV");n.className="comment",n.appendChild(t("nickname",this.nickname)),n.appendChild(t("date",this.date));var i=document.createElement("DIV");i.className="comment-text",i.appendChild(t("",this.text)),n.appendChild(i),e.appendChild(n)},t.exports=n}()},{"./scrollbar.es6.js":3}],3:[function(e,t,n){!function(){t.exports=function(e,t){var n=e.parentNode,i=document.querySelector(n.getAttribute("data-scrolled-area")),r=i.parentNode,o=function(){var e=i.clientWidth,t=r.clientWidth;return e>t?t/e*100+"%":"100%"};this.adjustSize=function(){var t=o();"100%"==t?n.style.opacity=0:(n.style.opacity=1,e.style.width=t)};var a=function(){var t=null,n=parseFloat(window.getComputedStyle(e).marginLeft),i=e.parentNode.clientWidth,o=function e(o){var a=void 0,l=e.currentTarget,c=e.scrollBarSize,s=e.scrollAreaSize;return null===t?void(t=o.clientX):(a=o.clientX-t,t=o.clientX,n+=a,n<=0?(l.style.marginLeft=n=0,void(r.scrollLeft=0)):(c+n>=i&&(n=i-c),l.style.marginLeft=n+"px",void(r.scrollLeft=n/i*s)))},a=function(){window.removeEventListener("mousemove",o),t=null};return window.addEventListener("mouseup",a),window.addEventListener("blur",a),o}();e.addEventListener("mousedown",function(e){a.currentTarget=e.target,"h"==t?(a.scrollBarSize=e.target.clientWidth,a.scrollAreaSize=i.clientWidth):"v"==t&&(a.scrollBarSize=e.target.clientHeight,a.scrollAreaSize=i.clientHeight),window.addEventListener("mousemove",a)})}}()},{}]},{},[1]);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uZXM2LmpzIl0sIm5hbWVzIjpbImUiLCJ0IiwibiIsInIiLCJzIiwibyIsInUiLCJhIiwicmVxdWlyZSIsImkiLCJFcnJvciIsImYiLCJleHBvcnRzIiwiY2FsbCIsImxlbmd0aCIsIjEiLCJtb2R1bGUiLCJnZXREYXRhIiwieGhyIiwiWE1MSHR0cFJlcXVlc3QiLCJkYXRhIiwib25yZWFkeXN0YXRlY2hhbmdlIiwicmVhZHlTdGF0ZSIsInN0YXR1cyIsIkpTT04iLCJwYXJzZSIsInJlc3BvbnNlIiwiYWxlcnQiLCJpbWFnZUNvbGxlY3Rpb24iLCJJbWFnZUNvbGxlY3Rpb24iLCJvcGVuIiwic2VuZCIsImZhZGVQb3B1cCIsImRpcmVjdGlvbiIsIm5vZGUiLCJ0cmFuc2l0aW9uRHVyYXRpb24iLCJwYXJzZUZsb2F0Iiwid2luZG93IiwiZ2V0Q29tcHV0ZWRTdHlsZSIsInN0eWxlIiwiZGlzcGxheSIsIm9wYWNpdHkiLCJzZXRUaW1lb3V0IiwiaGFzQ2xhc3MiLCJlbGVtIiwiY2xhc3NOYW1lIiwiY2xhc3NlcyIsInNwbGl0IiwiaW5kZXhPZiIsInJlbW92ZUNsYXNzIiwiaW5kZXgiLCJzcGxpY2UiLCJqb2luIiwiYWRkQ2xhc3MiLCJkb2N1bWVudCIsImFkZEV2ZW50TGlzdGVuZXIiLCJpbnB1dEhhbmRsZXIiLCJuaWNrbmFtZSIsImlucHV0cyIsIm5pY2tuYW1lTm9kZSIsImNvbW1lbnQiLCJjb21tZW50Tm9kZSIsInRndCIsInRhcmdldCIsImJ1dHRvbiIsInZhbHVlIiwiYm9yZGVyQ29sb3IiLCJjdXJzb3IiLCJmaWxlSGFuZGxlciIsIm9yaWVudGF0aW9uUG9wdXAiLCJxdWVyeVNlbGVjdG9yIiwiZmlsZSIsImZpbGVzIiwiaW1nVHlwZVBhdHRlcm4iLCJyZWFkZXIiLCJ0ZXN0IiwidHlwZSIsIkZpbGVSZWFkZXIiLCJvbmxvYWQiLCJpbWdzIiwicXVlcnlTZWxlY3RvckFsbCIsImZvckVhY2giLCJpbWciLCJzcmMiLCJyZXN1bHQiLCJyZWFkQXNEYXRhVVJMIiwiZ2V0RWxlbWVudEJ5SWQiLCJuaWNrbmFtZUxhYmVsIiwiY29tbWVudExhYmVsIiwicGxhY2Vob2xkZXJzIiwiZ2V0QXR0cmlidXRlIiwiYmx1ckhhbmRsZXIiLCJ0YWdOYW1lIiwibGFiZWwiLCJuZXh0RWxlbWVudFNpYmxpbmciLCJzZXRBdHRyaWJ1dGUiLCJjb2xvciIsImlkIiwiY2xpY2tMaXN0ZW5lciIsInNob3dCaWdJbWdQb3B1cCIsImltZ1Bvc3QiLCJnZXRJbWFnZVBvc3QiLCJpbWdCaWciLCJiYWNrZ3JvdW5kSW1hZ2UiLCJsaWtlSWNvbiIsImxpa2VzIiwiZGlzbGlrZUljb24iLCJkaXNsaWtlcyIsImNvbW1lbnRzTnVtYmVyIiwidGV4dENvbnRlbnQiLCJjb21tZW50cyIsInNob3dDb21tZW50cyIsImJpZ0ltZ1BvcHVwIiwiY3VycmVudElkIiwiY3JlYXRlTmV3SW1nUG9zdCIsIm9yaWVudGF0aW9uIiwiYWRkSW1hZ2VQb3N0IiwiaGFuZGxlQmlnSW1nQnV0dG9ucyIsInBhcmVudE5vZGUiLCJvdGhlckNsaWNrZWRCdXR0b24iLCJpc0xpa2UiLCJldmFsdWF0ZSIsImFkZENvbW1lbnQiLCJjbGVhclBvcHVwIiwiY2xpY2tlZEJ1dHRvbiIsIm5pY2tuYW1lUGxhY2Vob2xkZXIiLCJjb21tZW50UGxhY2Vob2xkZXIiLCJmaXJzdEVsZW1lbnRDaGlsZCIsInByZXZlbnREZWZhdWx0IiwiYm9keSIsIi4vbW9kdWxlcy9pbWFnZS1jb2xsZWN0aW9uLmVzNi5qcyIsIi4vbW9kdWxlcy9zY3JvbGxiYXIuZXM2LmpzIiwiMiIsImdldExhc3RJZCIsImNvbGxlY3Rpb24iLCJsYXN0SWQiLCJwdXNoIiwiSW1hZ2VQb3N0IiwidGhpcyIsImNvbnNvbGUiLCJsb2ciLCJpbWdJbmZvT2JqIiwiaW1hZ2VQb3N0IiwiX3RoaXMiLCJpbWdTbWFsbCIsIkNvbW1lbnQiLCJ0ZXh0IiwiZGF0ZSIsInB1dEluR3JpZCIsInNlbGYiLCJhZGRJY29uIiwiZGF0YUNvdW50IiwiaWNvbiIsImNyZWF0ZUVsZW1lbnQiLCJncmlkSXRlbSIsImhvdmVyQm94IiwiYWx0IiwiYXBwZW5kQ2hpbGQiLCJncmlkIiwiaW5zZXJ0QmVmb3JlIiwibGFzdEVsZW1lbnRDaGlsZCIsInBja3J5IiwicmVsb2FkSXRlbXMiLCJsYXlvdXQiLCJzY3JvbGxYIiwiYWRqdXN0U2l6ZSIsIkRhdGUiLCJTY3JvbGxiYXIiLCJQYWNrZXJ5IiwiaXRlbVNlbGVjdG9yIiwiZ3V0dGVyIiwiaG9yaXpvbnRhbCIsInByb3RvdHlwZSIsImlzUGx1cyIsImV2YWx1YXRpb24iLCJpY29uU21hbGwiLCJjdXJyZW50VmFsdWUiLCJpbm5lckhUTUwiLCJwdXRPblBhZ2UiLCJjcmVhdGVTcGFuIiwic3BhbiIsIi4vc2Nyb2xsYmFyLmVzNi5qcyIsIjMiLCJzY3JvbGxCYXIiLCJzY3JvbGxCb3giLCJzY3JvbGxlZEFyZWEiLCJzY3JvbGxlZEJveCIsImdldEFyZWFUb0JveFJhdGlvIiwiYXJlYVdpZHRoIiwiY2xpZW50V2lkdGgiLCJib3hXaWR0aCIsInJhdGlvIiwid2lkdGgiLCJvbk1vdmUiLCJsYXN0TW91c2VYIiwibWFyZ2luIiwibWFyZ2luTGVmdCIsInNjcm9sbEJveFdpZHRoIiwiZGlmZiIsImN1cnJlbnRUYXJnZXQiLCJzY3JvbGxCYXJTaXplIiwic2Nyb2xsQXJlYVNpemUiLCJjbGllbnRYIiwic2Nyb2xsTGVmdCIsInJlbW92ZVNjcm9sbExpc3RlbmVycyIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJjbGllbnRIZWlnaHQiXSwibWFwcGluZ3MiOiJjQUFBLFFBQVVBLEdBQUVDLEVBQUVDLEVBQUVDLEdBQUcsUUFBU0MsR0FBRUMsRUFBRUMsR0FBRyxJQUFJSixFQUFFRyxHQUFHLENBQUMsSUFBSUosRUFBRUksR0FBRyxDQUFDLEdBQUlFLEdBQWtCLGtCQUFUQyxVQUFxQkEsT0FBUSxLQUFJRixHQUFHQyxFQUFFLE1BQU9BLEdBQUVGLEdBQUUsRUFBSSxJQUFHSSxFQUFFLE1BQU9BLEdBQUVKLEdBQUUsRUFBSSxNQUFNLElBQUlL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QUFpQixPQUFRcUosR0FFekJYLElBR1RWLEdBQVVoSSxpQkFBaUIsWUFBYSxTQUFDdkQsR0FFdkNpTSxFQUFPTSxjQUFnQnZNLEVBQUUrRCxPQUlSLEtBQWI5QixHQUNGZ0ssRUFBT08sY0FBZ0J4TSxFQUFFK0QsT0FBTzhILFlBQ2hDSSxFQUFPUSxlQUFpQmhCLEVBQWFJLGFBQ2YsS0FBYjVKLElBQ1RnSyxFQUFPTyxjQUFnQnhNLEVBQUUrRCxPQUFPK0ksYUFDaENiLEVBQU9RLGVBQWlCaEIsRUFBYXFCLGNBR3ZDekssT0FBT2tCLGlCQUFpQixZQUFhMEksbUJBTzlCIiwiZmlsZSI6ImJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKX12YXIgZj1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwoZi5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxmLGYuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pKHsxOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXtcbi8vIFRPRE86IGFkZCBwb3B1cCBcIm9uYmx1clwiXHJcbigoKSA9PiB7XHJcbid1c2Ugc3RyaWN0JztcclxuXHJcbmNvbnN0IFNjcm9sbGJhciA9IHJlcXVpcmUoJy4vbW9kdWxlcy9zY3JvbGxiYXIuZXM2LmpzJyk7XHJcbmNvbnN0IEltYWdlQ29sbGVjdGlvbiA9IHJlcXVpcmUoJy4vbW9kdWxlcy9pbWFnZS1jb2xsZWN0aW9uLmVzNi5qcycpO1xyXG5cclxuLy8gQUxMIFRIRSBJTkZPUk1BVElPTiBBQk9VVCBJTUFHRVMsIElOQ0xVRElORyBDT01NRU5UU1xyXG5sZXQgaW1hZ2VDb2xsZWN0aW9uID0ge307XHJcbmdldERhdGEoKTtcclxuXHJcbmZ1bmN0aW9uIGdldERhdGEoKSB7XHJcbiAgbGV0IHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpLCBkYXRhO1xyXG4gIHhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSAoKSA9PiB7XHJcblxyXG4gICAgaWYgKHhoci5yZWFkeVN0YXRlID09IDQgJiYgeGhyLnN0YXR1cyA9PSAyMDApIHtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBkYXRhID0gSlNPTi5wYXJzZSh4aHIucmVzcG9uc2UpO1xyXG4gICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgYWxlcnQoJ0ludmFsaWQgU2VydmVyIHJlc3BvbnNlLiBTb3JyeSEnKTtcclxuICAgICAgfVxyXG4gICAgICBpbWFnZUNvbGxlY3Rpb24gPSBuZXcgSW1hZ2VDb2xsZWN0aW9uKGRhdGEpO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIHhoci5vcGVuKCdHRVQnLCAnZGF0YS9pbWFnZV9wb3N0cy5qc29uJyk7XHJcbiAgeGhyLnNlbmQoKTtcclxufVxyXG5cclxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpID0+IHtcclxuICAvL1RPRE86IGFkZCBsb2FkZXIgaW50byBncmlkIGNvcyBpbWFnZXMgbG9hZGluZyBjYW4gdGFrZSBhIHdoaWxlXHJcblxyXG4gIC8vIEFERElORyBORVcgSU1BR0VcclxuICBsZXQgZmlsZUhhbmRsZXIgPSAoKCkgPT4ge1xyXG4gICAgbGV0IG9yaWVudGF0aW9uUG9wdXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXAub3JpZW50YXRpb24tY2hvc2UnKTtcclxuXHJcbiAgICByZXR1cm4gKGUpID0+IHtcclxuICAgICAgbGV0IGZpbGUgPSBlLnRhcmdldC5maWxlc1swXSxcclxuICAgICAgICAgIGltZ1R5cGVQYXR0ZXJuID0gL15pbWFnZVxcLy8sXHJcbiAgICAgICAgICByZWFkZXI7XHJcblxyXG4gICAgICAvLyB1c3IgZGlkbid0IHVwbG9hZCBhbnl0aGluZ1xyXG4gICAgICBpZiAoIWZpbGUpIHJldHVybjtcclxuXHJcbiAgICAgIC8vIGlmIG5vdCBvZiB0eXBlIGltYWdlXHJcbiAgICAgIGlmICghaW1nVHlwZVBhdHRlcm4udGVzdChmaWxlLnR5cGUpKSB7XHJcbiAgICAgICAgYWxlcnQoJ1lvdSBtdXN0IHVwbG9hZCBhbiBpbWFnZSEnKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XHJcblxyXG4gICAgICByZWFkZXIub25sb2FkID0gKGUpID0+IHtcclxuICAgICAgICBsZXQgaW1ncyA9IG9yaWVudGF0aW9uUG9wdXAucXVlcnlTZWxlY3RvckFsbCgnaW1nJyk7XHJcbiAgICAgICAgW10uZm9yRWFjaC5jYWxsKGltZ3MsIChpbWcpID0+IHtcclxuICAgICAgICAgIGltZy5zcmMgPSBlLnRhcmdldC5yZXN1bHQ7XHJcblxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBmYWRlUG9wdXAoJ2luJywgb3JpZW50YXRpb25Qb3B1cCk7XHJcbiAgICAgIH07XHJcblxyXG4gICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTtcclxuICAgIH07XHJcbiAgfSkoKTtcclxuXHJcblxyXG4gIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W3R5cGU9XCJmaWxlXCJdJylcclxuICAuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZmlsZUhhbmRsZXIpO1xyXG5cclxuICAvLyBGT1JNIFZBTElEQVRJT05cclxuICBsZXQgaW5wdXRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwLWNvbW1lbnRzJyk7XHJcbiAgaW5wdXRzLm5pY2tuYW1lTm9kZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduaWNrbmFtZScpO1xyXG4gIGlucHV0cy5jb21tZW50Tm9kZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb21tZW50Jyk7XHJcbiAgaW5wdXRzLm5pY2tuYW1lTGFiZWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZm9yPVwibmlja25hbWVcIl0nKTtcclxuICBpbnB1dHMuY29tbWVudExhYmVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2Zvcj1cImNvbW1lbnRcIl0nKTtcclxuICBpbnB1dHMucGxhY2Vob2xkZXJzID0ge1xyXG4gICAgbmlja25hbWU6IGlucHV0cy5uaWNrbmFtZUxhYmVsLmdldEF0dHJpYnV0ZSgnZGF0YS1wbGFjZWhvbGRlcicpLFxyXG4gICAgY29tbWVudDogaW5wdXRzLmNvbW1lbnRMYWJlbC5nZXRBdHRyaWJ1dGUoJ2RhdGEtcGxhY2Vob2xkZXInKVxyXG4gIH07XHJcbiAgaW5wdXRzLmJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZW5kLWJ1dHRvbicpO1xyXG5cclxuICBsZXQgYmx1ckhhbmRsZXIgPSAoKCkgPT4ge1xyXG4gICAgbGV0IHBsYWNlaG9sZGVycyA9IGlucHV0cy5wbGFjZWhvbGRlcnM7XHJcblxyXG4gICAgcmV0dXJuIChlKSA9PiB7XHJcbiAgICAgIGxldCB0Z3QgPSBlLnRhcmdldDtcclxuICAgICAgaWYgKHRndC50YWdOYW1lICE9PSAnSU5QVVQnKSByZXR1cm47XHJcbiAgICAgIGxldCBsYWJlbCA9IHRndC5uZXh0RWxlbWVudFNpYmxpbmc7XHJcblxyXG4gICAgICBpZiAoIXRndC52YWx1ZSkge1xyXG4gICAgICAgIHRndC5zdHlsZS5ib3JkZXJDb2xvciA9ICdyZWQnO1xyXG4gICAgICAgIGxhYmVsLnN0eWxlLmNvbG9yID0gJ3JlZCc7XHJcbiAgICAgICAgLy8gYWRkIHBsYWNlaG9sZGVyXHJcbiAgICAgICAgbGFiZWwuc2V0QXR0cmlidXRlKCdkYXRhLXBsYWNlaG9sZGVyJywgcGxhY2Vob2xkZXJzW3RndC5pZF0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRndC5zdHlsZS5ib3JkZXJDb2xvciA9ICcnO1xyXG4gICAgICAgIC8vIHJlbWVtYmVyIGFuZCBkZWxldGUgcGxhY2Vob2xkZXJcclxuICAgICAgICBsYWJlbC5zZXRBdHRyaWJ1dGUoJ2RhdGEtcGxhY2Vob2xkZXInLCAnJyk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgfSkoKTtcclxuXHJcbiAgaW5wdXRzLmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCBibHVySGFuZGxlciwgdHJ1ZSk7XHJcblxyXG4gIGZ1bmN0aW9uIGlucHV0SGFuZGxlcihlKSB7XHJcbiAgICBsZXQgbmlja25hbWUgPSBpbnB1dHMubmlja25hbWVOb2RlO1xyXG4gICAgbGV0IGNvbW1lbnQgPSBpbnB1dHMuY29tbWVudE5vZGU7XHJcbiAgICBsZXQgdGd0ID0gZS50YXJnZXQ7XHJcbiAgICBsZXQgYnV0dG9uID0gaW5wdXRzLmJ1dHRvbjtcclxuXHJcbiAgICBpZiAodGd0LnZhbHVlKSB7XHJcbiAgICAgIHRndC5zdHlsZS5ib3JkZXJDb2xvciA9ICcnO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghdGd0LnZhbHVlKSB7XHJcbiAgICAgIGJ1dHRvbi5zdHlsZS5jdXJzb3IgPSAnJztcclxuICAgIH1cclxuXHJcbiAgICBpZiAobmlja25hbWUudmFsdWUgJiYgY29tbWVudC52YWx1ZSkge1xyXG4gICAgICBidXR0b24uc3R5bGUuY3Vyc29yID0gJ3BvaW50ZXInO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgaW5wdXRzLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgaW5wdXRIYW5kbGVyKTtcclxuXHJcblxyXG4gIC8vIEdSSUQgTElTVEVORVJTIC0+IFBPUFVQICYmIEFERCBORVcgSU1BR0VcclxuICBsZXQgY2xpY2tMaXN0ZW5lciA9ICgoKSA9PiB7XHJcbiAgICAvL2Nsb3N1cmVcclxuICAgIGxldCBiaWdJbWdQb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cC5iaWctaW1nJyk7XHJcbiAgICBsZXQgaW1nQmlnID0gYmlnSW1nUG9wdXAucXVlcnlTZWxlY3RvcignLmltYWdlLWJpZycpO1xyXG4gICAgbGV0IGxpa2VJY29uID0gYmlnSW1nUG9wdXAucXVlcnlTZWxlY3RvcignLnNwcml0ZS1saWtlJyk7XHJcbiAgICBsZXQgZGlzbGlrZUljb24gPSBiaWdJbWdQb3B1cC5xdWVyeVNlbGVjdG9yKCcuc3ByaXRlLWRpc2xpa2UnKTtcclxuICAgIGxldCBjb21tZW50c051bWJlciA9IGJpZ0ltZ1BvcHVwLnF1ZXJ5U2VsZWN0b3IoJ2gyIHNwYW4nKTtcclxuICAgIGxldCBvcmllbnRhdGlvblBvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwLm9yaWVudGF0aW9uLWNob3NlJyk7XHJcbiAgICBsZXQgb3JpZW50YXRpb247XHJcblxyXG4gICAgZnVuY3Rpb24gc2hvd0JpZ0ltZ1BvcHVwKHRhcmdldCkge1xyXG4gICAgICBsZXQgaWQgPSArdGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1pZCcpO1xyXG4gICAgICBsZXQgaW1nUG9zdCA9IGltYWdlQ29sbGVjdGlvbi5nZXRJbWFnZVBvc3QoaWQpO1xyXG5cclxuICAgICAgaW1nQmlnLnN0eWxlLmJhY2tncm91bmRJbWFnZSA9ICd1cmwoJyArIGltZ1Bvc3QuaW1nQmlnICsgJyknO1xyXG4gICAgICBsaWtlSWNvbi5zZXRBdHRyaWJ1dGUoJ2RhdGEtY291bnQnLCBpbWdQb3N0Lmxpa2VzKTtcclxuICAgICAgZGlzbGlrZUljb24uc2V0QXR0cmlidXRlKCdkYXRhLWNvdW50JywgaW1nUG9zdC5kaXNsaWtlcyk7XHJcbiAgICAgIGNvbW1lbnRzTnVtYmVyLnRleHRDb250ZW50ID0gaW1nUG9zdC5jb21tZW50cy5sZW5ndGg7XHJcblxyXG4gICAgICBpbWdQb3N0LnNob3dDb21tZW50cyhiaWdJbWdQb3B1cC5xdWVyeVNlbGVjdG9yKCcuY29tbWVudHMnKSk7XHJcbiAgICAgIGZhZGVQb3B1cCgnaW4nLCBiaWdJbWdQb3B1cCk7XHJcblxyXG4gICAgICAvLyByZW1lbWJlciBpZCBvZiB0aGUgY3VycmVudCBpbWFnZVxyXG4gICAgICBiaWdJbWdQb3B1cC5jdXJyZW50SWQgPSBpZDtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBjcmVhdGVOZXdJbWdQb3N0KGltZ0JpZywgb3JpZW50YXRpb24pIHtcclxuICAgICAgaW1hZ2VDb2xsZWN0aW9uLmFkZEltYWdlUG9zdCh7aW1nQmlnLCBvcmllbnRhdGlvbn0pO1xyXG4gICAgICBmYWRlUG9wdXAoJ291dCcsIG9yaWVudGF0aW9uUG9wdXApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIHRndCAtPiBjbGljayB0YXJnZXRcclxuICAgIGZ1bmN0aW9uIGhhbmRsZUJpZ0ltZ0J1dHRvbnModGd0KSB7XHJcbiAgICAvLyBpZiBjbGljayBvbiBjaGlsZCBub2RlXHJcbiAgICAgIGlmICh0Z3QudGFnTmFtZSA9PT0gJ0knKSB0Z3QgPSB0Z3QucGFyZW50Tm9kZTtcclxuXHJcbiAgICAgIGlmIChoYXNDbGFzcyh0Z3QsICdjbGlja2VkJykpIHJldHVybjtcclxuICAgIC8vIGlmIHRoZXJlIGlzIGFscmVhZHkgYSBjbGlja2VkIGJ1dHRvbiAtPiB1bmNsaWNrIGl0XHJcbiAgICAgIGxldCBvdGhlckNsaWNrZWRCdXR0b24gPSBiaWdJbWdQb3B1cC5xdWVyeVNlbGVjdG9yKCcuaW1hZ2UtYnV0dG9uLmNsaWNrZWQnKTtcclxuICAgICAgbGV0IGlzTGlrZSA9IGhhc0NsYXNzKHRndCwgJ2xpa2UnKTtcclxuXHJcbiAgICAgIGlmIChvdGhlckNsaWNrZWRCdXR0b24pIHtcclxuICAgICAgICAvLyAtMSBmb3IgbGlrZXMgb3IgZGlzbGlrZXNcclxuICAgICAgICByZW1vdmVDbGFzcyhvdGhlckNsaWNrZWRCdXR0b24sICdjbGlja2VkJyk7XHJcbiAgICAgICAgaW1hZ2VDb2xsZWN0aW9uLmV2YWx1YXRlKGJpZ0ltZ1BvcHVwLmN1cnJlbnRJZCwgIWlzTGlrZSwgZmFsc2UsIG90aGVyQ2xpY2tlZEJ1dHRvbik7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIFwicHJlc3NcIiB0aGUgYnV0dG9uXHJcbiAgICAgIGFkZENsYXNzKHRndCwgJ2NsaWNrZWQnKTtcclxuICAgICAgLy8gKzEgZm9yIGxpa2VzIG9yIGRpc2xpa2VzXHJcbiAgICAgIGltYWdlQ29sbGVjdGlvbi5ldmFsdWF0ZShiaWdJbWdQb3B1cC5jdXJyZW50SWQsIGlzTGlrZSwgdHJ1ZSwgdGd0KTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBhZGRDb21tZW50KCkge1xyXG4gICAgICBpZiAoIWlucHV0cy5uaWNrbmFtZU5vZGUudmFsdWUgfHwgIWlucHV0cy5jb21tZW50Tm9kZS52YWx1ZSkgcmV0dXJuO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBjbGVhclBvcHVwKCkge1xyXG4gICAgICAvLyB1bmNsaWNrIGxpa2UgYnV0dG9uc1xyXG4gICAgICBsZXQgY2xpY2tlZEJ1dHRvbiA9IGJpZ0ltZ1BvcHVwLnF1ZXJ5U2VsZWN0b3IoJy5jbGlja2VkJyk7XHJcbiAgICAgIGlmIChjbGlja2VkQnV0dG9uKSByZW1vdmVDbGFzcyhjbGlja2VkQnV0dG9uLCAnY2xpY2tlZCcpO1xyXG5cclxuICAgICAgLy8gcmVtb3ZlIGN1cnJlbnQgaW5wdXQgdmFsdWVzIGFuZCBzdHlsaW5nXHJcbiAgICAgIGxldCBuaWNrbmFtZSA9IGlucHV0cy5uaWNrbmFtZU5vZGU7XHJcbiAgICAgIGxldCBjb21tZW50ID0gaW5wdXRzLmNvbW1lbnROb2RlO1xyXG4gICAgICBsZXQgbmlja25hbWVQbGFjZWhvbGRlciA9IGlucHV0cy5wbGFjZWhvbGRlcnMubmlja25hbWU7XHJcbiAgICAgIGxldCBjb21tZW50UGxhY2Vob2xkZXIgPSBpbnB1dHMucGxhY2Vob2xkZXJzLmNvbW1lbnQ7XHJcbiAgICAgIGxldCBuaWNrbmFtZUxhYmVsID0gaW5wdXRzLm5pY2tuYW1lTGFiZWw7XHJcbiAgICAgIGxldCBjb21tZW50TGFiZWwgPSBpbnB1dHMuY29tbWVudExhYmVsO1xyXG5cclxuICAgICAgbmlja25hbWUudmFsdWUgPSBjb21tZW50LnZhbHVlID0gJyc7XHJcbiAgICAgIG5pY2tuYW1lLnN0eWxlLmJvcmRlckNvbG9yID1cclxuICAgICAgY29tbWVudC5zdHlsZS5ib3JkZXJDb2xvciA9ICcnO1xyXG4gICAgICBuaWNrbmFtZUxhYmVsLnN0eWxlLmNvbG9yID0gY29tbWVudExhYmVsLnN0eWxlLmNvbG9yID0gJyc7XHJcbiAgICAgIGlucHV0cy5idXR0b24uc3R5bGUuY3Vyc29yID0gJyc7XHJcblxyXG4gICAgICAvLyBhZGQgcGxhY2Vob2xkZXJzXHJcbiAgICAgIG5pY2tuYW1lTGFiZWwuc2V0QXR0cmlidXRlKCdkYXRhLXBsYWNlaG9sZGVyJywgbmlja25hbWVQbGFjZWhvbGRlcik7XHJcbiAgICAgIGNvbW1lbnRMYWJlbC5zZXRBdHRyaWJ1dGUoJ2RhdGEtcGxhY2Vob2xkZXInLCBjb21tZW50UGxhY2Vob2xkZXIpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGFjdHVhbCBsaXN0ZW5lclxyXG4gICAgcmV0dXJuIChlKSA9PiB7XHJcbiAgICAgIGxldCB0YXJnZXQgPSBlLnRhcmdldDtcclxuXHJcbiAgICAgIC8vIGNsaWNrIG9uIGltYWdlcyBvbiBtYWluIHdpbmRvd1xyXG4gICAgICBpZiAodGFyZ2V0LnRhZ05hbWUgPT09ICdJTUcnKSB7XHJcbiAgICAgICAgc2hvd0JpZ0ltZ1BvcHVwKHRhcmdldCk7XHJcblxyXG4gICAgICAvLyBjbGljayBvbiBvcmllbnRhdGlvbiBpbWFnZXMgb24gcG9wdXBcclxuICAgICAgfSBlbHNlIGlmIChvcmllbnRhdGlvbiA9IHRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtb3JpZW50YXRpb24nKSkge1xyXG5cclxuICAgICAgICBjcmVhdGVOZXdJbWdQb3N0KHRhcmdldC5maXJzdEVsZW1lbnRDaGlsZC5zcmMsIG9yaWVudGF0aW9uKTtcclxuXHJcbiAgICAgIC8vICoqKioqKioqKioqKiogUE9QVVAgKioqKioqKioqKioqKioqKipcclxuICAgICAgLy8gTGlrZSBhbmQgRGlzbGlrZSBidXR0b25zXHJcbiAgICAgIH0gZWxzZSBpZiAoaGFzQ2xhc3ModGFyZ2V0LCAnaW1hZ2UtYnV0dG9uJykgfHxcclxuICAgICAgICAgICAgICAgaGFzQ2xhc3ModGFyZ2V0LnBhcmVudE5vZGUsICdpbWFnZS1idXR0b24nKSkge1xyXG5cclxuICAgICAgICBoYW5kbGVCaWdJbWdCdXR0b25zKHRhcmdldCk7XHJcblxyXG4gICAgICB9IGVsc2UgaWYgKGhhc0NsYXNzKHRhcmdldCwgJ3Nwcml0ZS1jbG9zZScpKSB7XHJcbiAgICAgICAgY2xlYXJQb3B1cCgpO1xyXG4gICAgICAgIGZhZGVQb3B1cCgnb3V0JywgYmlnSW1nUG9wdXApO1xyXG5cclxuICAgICAgLy90byBwcmV2ZW50IGZvY3VzaW5nIGlucHV0XHJcbiAgICB9IGVsc2UgaWYgKGhhc0NsYXNzKHRhcmdldCwgJ3NlbmQtYnV0dG9uJykgfHxcclxuICAgICAgICAgICAgICAgaGFzQ2xhc3ModGFyZ2V0LnBhcmVudE5vZGUsICdzZW5kLWJ1dHRvbicpKSB7XHJcbiAgICAgICAgYWRkQ29tbWVudCgpO1xyXG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICB9KSgpO1xyXG5cclxuICBkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY2xpY2tMaXN0ZW5lcik7XHJcblxyXG59KTsvL2VuZCBET01Db250ZW50TG9hZGVkXHJcblxyXG5cclxuLy8gVVNFRlVMIEZVTkNUSU9OU1xyXG5mdW5jdGlvbiBmYWRlUG9wdXAoZGlyZWN0aW9uLCBub2RlKSB7XHJcbiAgbGV0IHRyYW5zaXRpb25EdXJhdGlvbiA9IHBhcnNlRmxvYXQod2luZG93LmdldENvbXB1dGVkU3R5bGUobm9kZSkudHJhbnNpdGlvbkR1cmF0aW9uKSAqIDEwMDA7XHJcblxyXG4gIGlmIChkaXJlY3Rpb24gPT0gJ2luJykge1xyXG4gICAgbm9kZS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcclxuICAgIG5vZGUuc3R5bGUub3BhY2l0eSA9IDA7XHJcblxyXG4gICAgLy8gdG8gZW5hYmxlIHByb3BlciB0cmFuc2l0aW9uaW5nIHdpdGggbWluaW1hbCBkZWxheVxyXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHsgbm9kZS5zdHlsZS5vcGFjaXR5ID0gMTsgfSwgNCk7XHJcbiAgfSBlbHNlIHtcclxuICAgIG5vZGUuc3R5bGUub3BhY2l0eSA9IDA7XHJcblxyXG4gICAgLy8gdHJhbnNpdGlvbkR1cmF0aW9uXHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHsgbm9kZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOyB9LCB0cmFuc2l0aW9uRHVyYXRpb24pO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gaGFzQ2xhc3MoZWxlbSwgY2xhc3NOYW1lKSB7XHJcbiAgbGV0IGNsYXNzZXMgPSBlbGVtLmNsYXNzTmFtZS5zcGxpdCgnICcpO1xyXG4gIHJldHVybiBjbGFzc2VzLmluZGV4T2YoY2xhc3NOYW1lKSA+IC0xO1xyXG59XHJcblxyXG5mdW5jdGlvbiByZW1vdmVDbGFzcyhlbGVtLCBjbGFzc05hbWUpIHtcclxuICBsZXQgY2xhc3NlcyA9IGVsZW0uY2xhc3NOYW1lLnNwbGl0KCcgJyk7XHJcbiAgbGV0IGluZGV4ID0gY2xhc3Nlcy5pbmRleE9mKGNsYXNzTmFtZSk7XHJcbiAgaWYgKGluZGV4ID4gLTEpIGNsYXNzZXMuc3BsaWNlKGluZGV4LCAxKTtcclxuICBlbGVtLmNsYXNzTmFtZSA9IGNsYXNzZXMuam9pbignICcpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBhZGRDbGFzcyhlbGVtLCBjbGFzc05hbWUpIHtcclxuICBpZiAoIWhhc0NsYXNzKGVsZW0sIGNsYXNzTmFtZSkpXHJcbiAgZWxlbS5jbGFzc05hbWUgKz0gJyAnICsgY2xhc3NOYW1lO1xyXG59XHJcblxyXG5cclxufSkoKTtcclxuXHJcbi8vVE9ETzogRE9NIGVsZW1lbnRzLCB0aGF0IHUgbWFuYWdlIHRocm91Z2ggSlMgbXVzdCBoYXZlIGRhdGEtXHJcblxufSx7XCIuL21vZHVsZXMvaW1hZ2UtY29sbGVjdGlvbi5lczYuanNcIjoyLFwiLi9tb2R1bGVzL3Njcm9sbGJhci5lczYuanNcIjozfV0sMjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7XG4oZnVuY3Rpb24oKSB7XHJcbid1c2Ugc3RyaWN0JztcclxuXHJcbmNvbnN0IFNjcm9sbGJhciA9IHJlcXVpcmUoJy4vc2Nyb2xsYmFyLmVzNi5qcycpO1xyXG5cclxubGV0IGdyaWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZ3JpZCcpO1xyXG4vLyBzZXQgbGF5b3V0IG9mIGltYWdlc1xyXG5sZXQgcGNrcnkgPSBuZXcgUGFja2VyeShncmlkLCB7XHJcbiAgaXRlbVNlbGVjdG9yOiAnLmdyaWQtaXRlbScsXHJcbiAgZ3V0dGVyOiAxMCxcclxuICBob3Jpem9udGFsOiB0cnVlXHJcbn0pO1xyXG5cclxubGV0IHNjcm9sbFggPSBuZXcgU2Nyb2xsYmFyKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zY3JvbGwtYmFyJyksICdoJyk7XHJcbnNjcm9sbFguYWRqdXN0U2l6ZSgpO1xyXG5cclxuZnVuY3Rpb24gSW1hZ2VDb2xsZWN0aW9uKGRhdGEpIHtcclxuICBsZXQgY29sbGVjdGlvbiA9IFtdO1xyXG4gIGxldCBsYXN0SWQgPSBnZXRMYXN0SWQoZGF0YSk7XHJcblxyXG4gIGZ1bmN0aW9uIGdldExhc3RJZChkYXRhKSB7XHJcbiAgICBsZXQgaWQgPSAwO1xyXG4gICAgZm9yIChsZXQgaSA9IDAsIG4gPSBkYXRhLmxlbmd0aDsgaSA8IG47IGkrKykge1xyXG4gICAgICBpZCA9IChkYXRhW2ldLmlkID4gaWQpID8gZGF0YVtpXS5pZCA6IGlkO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGlkO1xyXG4gIH1cclxuXHJcbiAgZm9yIChsZXQgaSA9IDAsIG4gPSBkYXRhLmxlbmd0aDsgaSA8IG47IGkrKykge1xyXG4gICAgY29sbGVjdGlvbi5wdXNoKG5ldyBJbWFnZVBvc3QoZGF0YVtpXSkpO1xyXG4gIH1cclxuXHJcbiAgdGhpcy5nZXRJbWFnZVBvc3QgPSAoaWQpID0+IHtcclxuICAgIGZvciAobGV0IGkgPSAwLCBuID0gY29sbGVjdGlvbi5sZW5ndGg7IGkgPCBuOyBpKyspIHtcclxuICAgICAgaWYgKGNvbGxlY3Rpb25baV0uaWQgPT09IGlkKSByZXR1cm4gY29sbGVjdGlvbltpXTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zb2xlLmxvZygnTm8gaW1hZ2UgcG9zdCB3aXRoIGlkOicsIGlkKTtcclxuICB9O1xyXG5cclxuICB0aGlzLmFkZEltYWdlUG9zdCA9IChpbWdJbmZvT2JqKSA9PiB7XHJcbiAgICBpZiAoIWltZ0luZm9PYmouaWQpIGltZ0luZm9PYmouaWQgPSArK2xhc3RJZDtcclxuICAgIGxldCBpbWFnZVBvc3QgPSBuZXcgSW1hZ2VQb3N0KGltZ0luZm9PYmopO1xyXG4gICAgY29sbGVjdGlvbi5wdXNoKGltYWdlUG9zdCk7XHJcbiAgfTtcclxufVxyXG5cclxuSW1hZ2VDb2xsZWN0aW9uLnByb3RvdHlwZS5ldmFsdWF0ZSA9IGZ1bmN0aW9uKGlkLCBpc0xpa2UsIGlzUGx1cywgdGFyZ2V0KSB7XHJcbiAgbGV0IGltZ1Bvc3QgPSB0aGlzLmdldEltYWdlUG9zdChpZCk7XHJcbiAgbGV0IGltZ1NtYWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2RhdGEtaWQ9XCInICsgaWQgKyAnXCJdJyk7XHJcbiAgbGV0IGV2YWx1YXRpb24gPSBpc0xpa2UgPyAnbGlrZScgOiAnZGlzbGlrZSc7XHJcbiAgbGV0IGljb25TbWFsbCA9IGltZ1NtYWxsLm5leHRFbGVtZW50U2libGluZy5xdWVyeVNlbGVjdG9yKCcuc3ByaXRlLScgKyBldmFsdWF0aW9uKTtcclxuICBsZXQgY3VycmVudFZhbHVlO1xyXG5cclxuICAvLyByZXN1bHRzIGluICdsaWtlcycgfHwgJ2Rpc2xpa2VzJ1xyXG4gIGlmIChpc1BsdXMpIGN1cnJlbnRWYWx1ZSA9ICsraW1nUG9zdFtldmFsdWF0aW9uICsgJ3MnXTtcclxuICBlbHNlIGN1cnJlbnRWYWx1ZSA9IC0taW1nUG9zdFtldmFsdWF0aW9uICsgJ3MnXTtcclxuXHJcbiAgaWNvblNtYWxsLnNldEF0dHJpYnV0ZSgnZGF0YS1jb3VudCcsIGN1cnJlbnRWYWx1ZSk7XHJcbiAgdGFyZ2V0LmZpcnN0RWxlbWVudENoaWxkLnNldEF0dHJpYnV0ZSgnZGF0YS1jb3VudCcsIGN1cnJlbnRWYWx1ZSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIEltYWdlUG9zdChkYXRhKSB7XHJcbiAgdGhpcy5pZCA9IGRhdGEuaWQgfHwgbnVsbDtcclxuICB0aGlzLmltZ1NtYWxsID0gZGF0YS5pbWdTbWFsbCB8fCBkYXRhLmltZ0JpZztcclxuICB0aGlzLmltZ0JpZyA9IGRhdGEuaW1nQmlnO1xyXG4gIHRoaXMub3JpZW50YXRpb24gPSBkYXRhLm9yaWVudGF0aW9uIHx8ICdub3JtYWwnO1xyXG4gIHRoaXMubGlrZXMgPSBkYXRhLmxpa2VzIHx8IDA7XHJcbiAgdGhpcy5kaXNsaWtlcyA9IGRhdGEuZGlzbGlrZXMgfHwgMDtcclxuICB0aGlzLmNvbW1lbnRzID0gW107XHJcblxyXG4gIGRhdGEuY29tbWVudHMgJiYgZGF0YS5jb21tZW50cy5mb3JFYWNoKChjb21tZW50KSA9PiB7XHJcbiAgICB0aGlzLmNvbW1lbnRzLnB1c2gobmV3IENvbW1lbnQoXHJcbiAgICAgIGNvbW1lbnQudGV4dCxcclxuICAgICAgY29tbWVudC5uaWNrbmFtZSxcclxuICAgICAgY29tbWVudC5kYXRlXHJcbiAgICApKTtcclxuICB9KTtcclxuXHJcbiAgdGhpcy5ub2RlID0gcHV0SW5HcmlkKHRoaXMpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBwdXRJbkdyaWQoc2VsZikge1xyXG4gIGxldCBncmlkSXRlbSwgaW1nLCBob3ZlckJveCwgaWNvbjtcclxuXHJcbiAgZnVuY3Rpb24gYWRkSWNvbihjbGFzc05hbWUsIGRhdGFDb3VudCkge1xyXG4gICAgbGV0IGljb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdJJyk7XHJcbiAgICBpY29uLmNsYXNzTmFtZSA9ICdzcHJpdGUgJyArIGNsYXNzTmFtZTtcclxuICAgIGljb24uc2V0QXR0cmlidXRlKCdkYXRhLWNvdW50JywgZGF0YUNvdW50KTtcclxuICAgIHJldHVybiBpY29uO1xyXG4gIH1cclxuXHJcbiAgZ3JpZEl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdESVYnKTtcclxuXHJcbiAgc3dpdGNoKHNlbGYub3JpZW50YXRpb24pIHtcclxuICAgIGNhc2UgJ2xhbmRzY2FwZSc6XHJcbiAgICBncmlkSXRlbS5jbGFzc05hbWUgPSAnZ3JpZC1pdGVtIGdyaWQtaXRlbS0td2lkdGgnO1xyXG4gICAgYnJlYWs7XHJcblxyXG4gICAgY2FzZSAncG9ydHJhaXQnOlxyXG4gICAgZ3JpZEl0ZW0uY2xhc3NOYW1lID0gJ2dyaWQtaXRlbSBncmlkLWl0ZW0tLWhlaWdodCc7XHJcbiAgICBicmVhaztcclxuXHJcbiAgICBkZWZhdWx0OlxyXG4gICAgZ3JpZEl0ZW0uY2xhc3NOYW1lID0gJ2dyaWQtaXRlbSc7XHJcbiAgfVxyXG5cclxuICBpbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdJTUcnKTtcclxuICBpbWcuc3JjID0gc2VsZi5pbWdTbWFsbDtcclxuICBpbWcuYWx0ID0gJ0ltYWdlICcgKyBzZWxmLmlkO1xyXG4gIGltZy5zZXRBdHRyaWJ1dGUoJ2RhdGEtaWQnLCBzZWxmLmlkKTtcclxuICBncmlkSXRlbS5hcHBlbmRDaGlsZChpbWcpO1xyXG5cclxuICBob3ZlckJveCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ0RJVicpO1xyXG4gIGhvdmVyQm94LmNsYXNzTmFtZSA9ICdob3Zlci1ib3gnO1xyXG5cclxuICBob3ZlckJveC5hcHBlbmRDaGlsZChhZGRJY29uKCdzcHJpdGUtY29tbWVudCcsIHNlbGYuY29tbWVudHMubGVuZ3RoKSk7XHJcbiAgaG92ZXJCb3guYXBwZW5kQ2hpbGQoYWRkSWNvbignc3ByaXRlLWxpa2UnLCBzZWxmLmxpa2VzKSk7XHJcbiAgaG92ZXJCb3guYXBwZW5kQ2hpbGQoYWRkSWNvbignc3ByaXRlLWRpc2xpa2UnLCBzZWxmLmRpc2xpa2VzKSk7XHJcblxyXG4gIGdyaWRJdGVtLmFwcGVuZENoaWxkKGhvdmVyQm94KTtcclxuXHJcbiAgLy8gaW5zZXJ0IGJlZm9yZSBwbGFjZWhvbGRlciBmb3IgYWRkaW5nIGltYWdlc1xyXG4gIGdyaWQuaW5zZXJ0QmVmb3JlKGdyaWRJdGVtLCBncmlkLmxhc3RFbGVtZW50Q2hpbGQpO1xyXG5cclxuICAvL3JlZHJhdyBQYWNrZXJ5XHJcbiAgcGNrcnkucmVsb2FkSXRlbXMoKVxyXG4gIHBja3J5LmxheW91dCgpO1xyXG5cclxuICAvL2FkanVzdCBzY3JvbGxiYXJcclxuICBzY3JvbGxYLmFkanVzdFNpemUoKTtcclxuXHJcbiAgcmV0dXJuIGdyaWRJdGVtO1xyXG59XHJcblxyXG5JbWFnZVBvc3QucHJvdG90eXBlLnNob3dDb21tZW50cyA9IGZ1bmN0aW9uKHBhcmVudE5vZGUpIHtcclxuICAvLyBjbGVhciBkaXZcclxuICBwYXJlbnROb2RlLmlubmVySFRNTCA9ICcnO1xyXG4gIHRoaXMuY29tbWVudHMuZm9yRWFjaCgoY29tbWVudCkgPT4ge1xyXG4gICAgY29tbWVudC5wdXRPblBhZ2UocGFyZW50Tm9kZSk7XHJcbiAgfSk7XHJcbn07XHJcblxyXG5mdW5jdGlvbiBDb21tZW50KHRleHQsIG5pY2tuYW1lLCBkYXRlKSB7XHJcbiAgdGhpcy50ZXh0ID0gdGV4dDtcclxuICB0aGlzLm5pY2tuYW1lID0gbmlja25hbWU7XHJcbiAgLy9UT0RPOiBwYXJzZSBEYXRlXHJcbiAgdGhpcy5kYXRlID0gbmV3IERhdGUoZGF0ZSk7XHJcbn1cclxuXHJcbkNvbW1lbnQucHJvdG90eXBlLnB1dE9uUGFnZSA9IGZ1bmN0aW9uKHBhcmVudE5vZGUpIHtcclxuICBmdW5jdGlvbiBjcmVhdGVTcGFuKGNsYXNzTmFtZSwgdGV4dENvbnRlbnQpIHtcclxuICAgIGxldCBzcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnU1BBTicpO1xyXG4gICAgc3Bhbi5jbGFzc05hbWUgPSBjbGFzc05hbWU7XHJcbiAgICBzcGFuLnRleHRDb250ZW50ID0gdGV4dENvbnRlbnQ7XHJcbiAgICByZXR1cm4gc3BhbjtcclxuICB9XHJcblxyXG4gIGxldCBjb21tZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnRElWJyk7XHJcbiAgY29tbWVudC5jbGFzc05hbWUgPSAnY29tbWVudCc7XHJcblxyXG4gIGNvbW1lbnQuYXBwZW5kQ2hpbGQoY3JlYXRlU3Bhbignbmlja25hbWUnLCB0aGlzLm5pY2tuYW1lKSk7XHJcbiAgY29tbWVudC5hcHBlbmRDaGlsZChjcmVhdGVTcGFuKCdkYXRlJywgdGhpcy5kYXRlKSk7XHJcblxyXG4gIGxldCB0ZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnRElWJyk7XHJcbiAgdGV4dC5jbGFzc05hbWUgPSAnY29tbWVudC10ZXh0JztcclxuICB0ZXh0LmFwcGVuZENoaWxkKGNyZWF0ZVNwYW4oJycsIHRoaXMudGV4dCkpO1xyXG4gIGNvbW1lbnQuYXBwZW5kQ2hpbGQodGV4dCk7XHJcblxyXG4gIHBhcmVudE5vZGUuYXBwZW5kQ2hpbGQoY29tbWVudCk7XHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IEltYWdlQ29sbGVjdGlvbjtcclxuXHJcbn0oKSk7XHJcblxufSx7XCIuL3Njcm9sbGJhci5lczYuanNcIjozfV0sMzpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7XG4vL1RPRE86IGFkZCB3aGVlbCBldmVudHNcclxuKCgpID0+IHtcclxuJ3VzZSBzdHJpY3QnO1xyXG5cclxuLyoqXHJcbiAqIENvbnN0cnVjdG9yIGZ1bmN0aW9uIGZvciBzY3JvbGxiYXJzXHJcbiAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IHNjcm9sbEJhclxyXG4gKiBAcGFyYW0ge1N0cmluZ30gJ2gnIGZvciBob3Jpem9udGFsIHx8ICd2JyBmb3IgdmVydGljYWxcclxuICogQHJldHVybnMge09iamVjdH0gd2l0aCBtZXRob2RzIGZvciBoYW5kbGluZyBzY3JvbGxiYXJcclxuICovXHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIFNjcm9sbGJhcihzY3JvbGxCYXIsIGRpcmVjdGlvbikge1xyXG4gIGxldCBzY3JvbGxCb3ggPSBzY3JvbGxCYXIucGFyZW50Tm9kZTtcclxuICBsZXQgc2Nyb2xsZWRBcmVhID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvclxyXG4gICAgICAgICAgICAgICAgICAgKHNjcm9sbEJveC5nZXRBdHRyaWJ1dGUoJ2RhdGEtc2Nyb2xsZWQtYXJlYScpKTtcclxuICBsZXQgc2Nyb2xsZWRCb3ggPSBzY3JvbGxlZEFyZWEucGFyZW50Tm9kZTtcclxuXHJcbiAgLy8gaWYgZ3JpZCBpcyB3aWRlciByZXR1cm5zIHRoZSBkaWZmZXJlbmNlIGluIHBlcmNlbnRzXHJcbiAgLy8gb3RoZXJ3aXNlIHJldHVybnMgMTAwJVxyXG4gIGxldCBnZXRBcmVhVG9Cb3hSYXRpbyA9ICgpID0+IHtcclxuICAgIGxldCBhcmVhV2lkdGggPSBzY3JvbGxlZEFyZWEuY2xpZW50V2lkdGg7XHJcbiAgICBsZXQgYm94V2lkdGggPSBzY3JvbGxlZEJveC5jbGllbnRXaWR0aDtcclxuXHJcbiAgICBpZiAoYXJlYVdpZHRoID4gYm94V2lkdGgpIHtcclxuICAgICAgcmV0dXJuIChib3hXaWR0aCAvIGFyZWFXaWR0aCAqIDEwMCkgKyAnJSc7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gMTAwICsgJyUnO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIC8vIEVuYWJsZSBzY3JvbGwgaWYgYXJlYSBpcyB3aWRlclxyXG4gIC8vIHNldHMgc2l6ZSBvZiBzY3JvbGwtYmFyXHJcbiAgdGhpcy5hZGp1c3RTaXplID0gKCkgPT4ge1xyXG4gICAgbGV0IHJhdGlvID0gZ2V0QXJlYVRvQm94UmF0aW8oKTtcclxuXHJcbiAgICBpZiAocmF0aW8gPT0gJzEwMCUnKVxyXG4gICAgICBzY3JvbGxCb3guc3R5bGUub3BhY2l0eSA9IDA7XHJcbiAgICBlbHNlIHtcclxuICAgICAgc2Nyb2xsQm94LnN0eWxlLm9wYWNpdHkgPSAxO1xyXG4gICAgICBzY3JvbGxCYXIuc3R5bGUud2lkdGggPSByYXRpbztcclxuICAgIH1cclxuICB9O1xyXG5cclxuICAvLyBldmVudCBoYW5kbGVyIGZvciBzY3JvbGxiYXJzXHJcblxyXG4gIC8vIHVzZSBjbG9zdXJlIHRvIGtlZXAgdHJhY2sgb2YgbW91c2UgbW92ZVxyXG4gIC8vIGFuZCBhdHRhY2ggZXZlbnQgaGFuZGxlciB0byB3aW5kb3cgb25seSBvbmNlXHJcbiAgbGV0IG9uTW92ZSA9ICgoKSA9PiB7XHJcbiAgICAvL1ggZm9yIHNjcm9sbEJhclggYW5kIFkgZm9yIHNjcm9sbEJhcllcclxuICAgIGxldCBsYXN0TW91c2VYID0gbnVsbCxcclxuICAgICAgICBsYXN0TW91c2VZID0gbnVsbCxcclxuICAgICAgICBtYXJnaW4gPSBwYXJzZUZsb2F0KHdpbmRvdy5cclxuICAgICAgICAgICAgICAgICAgZ2V0Q29tcHV0ZWRTdHlsZShzY3JvbGxCYXIpLm1hcmdpbkxlZnQpLFxyXG4gICAgICAgIHNjcm9sbEJveFdpZHRoID0gc2Nyb2xsQmFyLnBhcmVudE5vZGUuY2xpZW50V2lkdGg7XHJcblxyXG4gICAgLy9vbk1vdmUgSGFuZGxlclxyXG4gICAgbGV0IG9uTW92ZSA9IChlKSA9PiB7XHJcbiAgICAgIGxldCBkaWZmLFxyXG4gICAgICAgICAgc2Nyb2xsQmFyID0gb25Nb3ZlLmN1cnJlbnRUYXJnZXQsXHJcbiAgICAgICAgICBzY3JvbGxCYXJTaXplID0gb25Nb3ZlLnNjcm9sbEJhclNpemUsXHJcbiAgICAgICAgICBzY3JvbGxBcmVhU2l6ZSA9IG9uTW92ZS5zY3JvbGxBcmVhU2l6ZTtcclxuXHJcbiAgICAgIC8vcmVtZW1iZXIgaW5pdGlhbCBwb3NpdGlvbiBvZiB0aGUgbW91c2VcclxuICAgICAgaWYgKGxhc3RNb3VzZVggPT09IG51bGwpIHtcclxuICAgICAgICBsYXN0TW91c2VYID0gZS5jbGllbnRYO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICAvLyBnZXQgbW91c2UgbW92ZVxyXG4gICAgICBkaWZmID0gZS5jbGllbnRYIC0gbGFzdE1vdXNlWDtcclxuICAgICAgbGFzdE1vdXNlWCA9IGUuY2xpZW50WDtcclxuXHJcbiAgICAgIG1hcmdpbiArPSBkaWZmO1xyXG4gICAgICAvL3ByZXZlbnQgZHJhZ2dpbmcgdG8gbGVmdCBpZiBvbiBlZGdlXHJcbiAgICAgIGlmIChtYXJnaW4gPD0gMCkge1xyXG4gICAgICAgIHNjcm9sbEJhci5zdHlsZS5tYXJnaW5MZWZ0ID0gbWFyZ2luID0gMDtcclxuICAgICAgICAvLyB0byBwcmV2ZW50IGluc3VmZmljaWVudCBzY3JvbGwsIHdoZW4gYnJvd3NlciByZW5kZXJzIHNjcm9sbCB0byBzbG93XHJcbiAgICAgICAgc2Nyb2xsZWRCb3guc2Nyb2xsTGVmdCA9IDA7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICAvL3ByZXZlbnQgZHJhZ2dpbmcgdG8gcmlnaHQgaWYgb24gZWRnZVxyXG4gICAgfSBlbHNlIGlmIChzY3JvbGxCYXJTaXplICsgbWFyZ2luID49IHNjcm9sbEJveFdpZHRoKSB7XHJcbiAgICAgICAgbWFyZ2luID0gc2Nyb2xsQm94V2lkdGggLSBzY3JvbGxCYXJTaXplO1xyXG4gICAgICB9XHJcbiAgICAgIHNjcm9sbEJhci5zdHlsZS5tYXJnaW5MZWZ0ID0gbWFyZ2luICsgJ3B4JztcclxuXHJcbiAgICAgIC8vYWRqdXN0IGdyaWQgcG9zaXRpb24gZHVlIHRvIHBlcmNlbnRhZ2UgdmFsdWUgb2Ygc2Nyb2xsLWJhciBtYXJnaW5cclxuICAgICAgLy8qKiotPi0+LT4gc2Nyb2xsYmFyLm1hcmdpbkxlZnQgLyBwYXJlbnQud2lkdGggPSAtZ3JpZC5tYXJnaW5MZWZ0IC8gZ3JpZC53aWR0aCA8LTwtPC0qKipcclxuICAgICAgc2Nyb2xsZWRCb3guc2Nyb2xsTGVmdCA9IG1hcmdpbiAvIHNjcm9sbEJveFdpZHRoICogc2Nyb2xsQXJlYVNpemU7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vdG8gZGlzYWJsZSBzY3JvbGxpbmcgb25tb3VzZXVwXHJcbiAgICBsZXQgcmVtb3ZlU2Nyb2xsTGlzdGVuZXJzID0gKCkgPT4ge1xyXG4gICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgb25Nb3ZlKTtcclxuICAgICAgbGFzdE1vdXNlWCA9IG51bGw7XHJcbiAgICB9O1xyXG5cclxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgcmVtb3ZlU2Nyb2xsTGlzdGVuZXJzKTtcclxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgcmVtb3ZlU2Nyb2xsTGlzdGVuZXJzKTtcclxuXHJcbiAgICByZXR1cm4gb25Nb3ZlO1xyXG4gIH0pKCk7XHJcblxyXG4gIHNjcm9sbEJhci5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCAoZSkgPT4ge1xyXG4gICAgLy9yZW1lbWJlciB3aGljaCBzY3JvbGxiYXIgd2UgYXJlIGN1cnJlbnRseSBvblxyXG4gICAgb25Nb3ZlLmN1cnJlbnRUYXJnZXQgPSBlLnRhcmdldDtcclxuXHJcbiAgICAvL3JlbWVtYmVyIHNpemUgb2YgdGhlIHNjcm9sbGJhciBhbmQgd2lkdGggb2YgdGhlIHNjcm9sbEFyZWFcclxuICAgIC8vdGhleSBhcmUgbmVlZGVkIGZvciBkcmFnZ2luZyBjb21wdXRhdGlvbnNcclxuICAgIGlmIChkaXJlY3Rpb24gPT0gJ2gnKSB7XHJcbiAgICAgIG9uTW92ZS5zY3JvbGxCYXJTaXplID0gZS50YXJnZXQuY2xpZW50V2lkdGg7XHJcbiAgICAgIG9uTW92ZS5zY3JvbGxBcmVhU2l6ZSA9IHNjcm9sbGVkQXJlYS5jbGllbnRXaWR0aDtcclxuICAgIH0gZWxzZSBpZiAoZGlyZWN0aW9uID09ICd2Jykge1xyXG4gICAgICBvbk1vdmUuc2Nyb2xsQmFyU2l6ZSA9IGUudGFyZ2V0LmNsaWVudEhlaWdodDtcclxuICAgICAgb25Nb3ZlLnNjcm9sbEFyZWFTaXplID0gc2Nyb2xsZWRBcmVhLmNsaWVudEhlaWdodDtcclxuICAgIH1cclxuXHJcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgb25Nb3ZlKTtcclxuICB9KTtcclxuXHJcbn07XHJcblxyXG59KSgpO1xyXG5cbn0se31dfSx7fSxbMV0pIl19
